    private SensorManager mSensorManager;


    private float beforeX;
    private float beforeY;
    private float beforeZ;
    private long beforeTime = -1;   
    private float shakeSpeed = 80;  
    private float shakeCount = 0;   

    @Override
    protected void onPause() {
        super.onPause();

        // ??????????
        if(mSensorManager != null)
            mSensorManager.unregisterListener(this);
    }

    @Override
    public void onSensorChanged(SensorEvent event){

        switch(event.sensor.getType()){

           
            case Sensor.TYPE_ACCELEROMETER:

                float x = event.values[0];
                float y = event.values[1];
                float z = event.values[2];
                long nowTime = System.currentTimeMillis();

              
                if( beforeTime == -1 ){
                    beforeX = x;
                    beforeY = y;
                    beforeZ = z;

                    beforeTime = nowTime;
                    break;
                }

        
                long diffTime = nowTime - beforeTime;
                if( diffTime < 500 )
                    break;

                float speed = Math.abs(x + y + z - beforeX - beforeY - beforeZ) / diffTime * 10000;

                if( speed > shakeSpeed ){
                  
                    if(++shakeCount > 2){
                        shakeCount = 0;

                    }
                }
                else {
                    
                    shakeCount = 0;
                }

          
                beforeX = x;
                beforeY = y;
                beforeZ = z;

                beforeTime = nowTime;

                break;
        }
    }
